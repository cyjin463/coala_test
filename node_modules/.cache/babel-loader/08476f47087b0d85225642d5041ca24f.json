{"ast":null,"code":"var _jsxFileName = \"/Users/cyj/sun/src/components/Postchat.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport Stomp, { over } from \"stompjs\";\nimport SockJs from \"sockjs-client\";\nimport Profile from \"../elements/Profile\";\nimport styled from \"styled-components\";\nimport Swal from \"sweetalert2\";\nimport { apiUrl } from \"../elements/testApiUrl\";\nimport { ReactComponent as SendSvg } from \"../svg/send.svg\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nlet stompClient = null;\n\nconst Postchat = _ref => {\n  _s();\n\n  let {\n    pid\n  } = _ref;\n  const token = {\n    Authorization: sessionStorage.getItem(\"token\")\n  };\n  const is_login = sessionStorage.getItem(\"is_Login\");\n  const username = sessionStorage.getItem(\"nickname\");\n  const crareer = sessionStorage.getItem(\"career\");\n  const userImage = sessionStorage.getItem(\"userImage\");\n  const uid = sessionStorage.getItem(\"uid\");\n  const [welcome, setWelcome] = React.useState(new Map());\n  const [publicChats, setPublicChats] = React.useState([]);\n  const [connected, setConnected] = React.useState(false);\n  const [tab, setTab] = React.useState(\"CHATROOM\");\n  const [time, setTime] = React.useState(\"\");\n  const [user, setUser] = React.useState(0);\n  const [userData, setUserData] = React.useState({\n    username: \"\",\n    message: \"\",\n    opposingUserName: \"\"\n  });\n  React.useEffect(() => {\n    stompConnect();\n    return () => {\n      stompDisConnect();\n    };\n  }, []);\n\n  const onKeyPress = e => {\n    if (e.key == \"Enter\") {\n      sendPublicMessage();\n    }\n  };\n\n  const stompDisConnect = () => {\n    try {\n      const user_join = {\n        status: \"OUT\"\n      };\n      stompClient.send(\"/app/message1\", {}, JSON.stringify(user_join));\n      stompClient.disconnect(() => {\n        stompClient.unsubscribe(`/topic/greetings/${pid}`);\n      }, token);\n    } catch (err) {}\n  };\n\n  const handleValue = e => {\n    const {\n      value,\n      name\n    } = e.target;\n    setUserData({ ...userData,\n      [name]: value\n    });\n  };\n\n  const stompConnect = () => {\n    let socket = new SockJs(`${apiUrl}/ws`);\n    stompClient = Stomp.over(socket);\n    stompClient.connect({}, onConnected, onError);\n  };\n\n  const onConnected = () => {\n    try {\n      const username = sessionStorage.getItem(\"nickname\");\n      const crareer = sessionStorage.getItem(\"career\");\n      const userImage = sessionStorage.getItem(\"userImage\");\n      const user_join = {\n        status: \"JOIN\",\n        pid,\n        uid\n      };\n      setConnected(true);\n      setUserData({ ...userData,\n        crareer,\n        senderName: username,\n        status: \"JOIN\",\n        pid: pid\n      });\n      stompClient.send(\"/app/message1\", token, JSON.stringify(user_join));\n      stompClient.subscribe(`/topic/greetings/${pid}`, onPublicMessageReceived, token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendPublicMessage = () => {\n    if (is_login) {\n      const username = sessionStorage.getItem(\"nickname\");\n\n      if (stompClient) {\n        if (!userData.message) {\n          Swal.fire(\"\", \"내용을 입력해주세요!\", \"error\");\n        } else {\n          let chatMessage = { ...userData,\n            senderName: username,\n            message: userData.message,\n            status: \"MESSAGE\",\n            pid: pid,\n            uid: uid\n          };\n          stompClient.send(\"/app/message1\", token, JSON.stringify(chatMessage));\n          setUserData({ ...userData,\n            message: \"\"\n          });\n        }\n      }\n    } else {\n      Swal.fire(\"\", \"로그인 후 사용할 수 있습니다:)\", \"error\");\n    }\n  }; //subscribe의 함수\n\n\n  const onPublicMessageReceived = payload => {\n    let payloadData = JSON.parse(payload.body);\n\n    switch (payloadData.status) {\n      case \"JOIN\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n          setUser(payloadData.userCount);\n        }\n\n        break;\n\n      case \"OUT\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n          setUser(payloadData.userCount);\n        }\n\n        break;\n\n      case \"OUT\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n        }\n\n        break;\n\n      case \"MESSAGE\":\n        const time1 = payloadData.createdAt.split(\"T\")[1]; //년월 제거\n\n        const time2 = time1.split(\".\")[0]; // 소수점 제거\n\n        const time3 = time2.split(\":\")[0] + \":\" + time2.split(\":\")[1]; // 시간, 분\n\n        setTime(time3);\n        publicChats.push(payloadData);\n        setPublicChats([...publicChats]);\n        setUser(payloadData.userCount);\n        break;\n    }\n  };\n\n  const onError = err => {\n    console.log(err);\n    console.log(\"plz\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(ChatDiv, {\n    children: [/*#__PURE__*/_jsxDEV(ChatTab, {\n      children: /*#__PURE__*/_jsxDEV(\"li\", {\n        onClick: () => {\n          setTab(\"CHATROOM\");\n        },\n        children: [\"\\uCC44\\uD305 \", user]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatList, {\n      children: /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [[...welcome.keys()].map((name, index) => {\n          return /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"welcome\",\n            children: name\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 15\n          }, this);\n        }), publicChats.map((chat, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          className: ` ${chat.senderName === username ? \"self\" : \"user\"}`,\n          children: [chat.senderName !== username && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(Profile, {\n              size: \"32\",\n              imgUrl: userData.userImage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: chat.senderName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 21\n              }, this), userData.crareer && /*#__PURE__*/_jsxDEV(\"i\", {\n                children: userData.crareer\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 42\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"message-data\",\n            children: chat.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 15\n          }, this), time.split[0] > 12 ? /*#__PURE__*/_jsxDEV(\"em\", {\n            children: [\" \\uC624\\uD6C4 \", time]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"em\", {\n            children: [\" \\uC624\\uC804 \", time, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 17\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"message\",\n          value: userData.message,\n          placeholder: \"\\uB313\\uAE00\\uC744 \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694 :)\",\n          onChange: handleValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendPublicMessage,\n          children: /*#__PURE__*/_jsxDEV(SendSvg, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Postchat, \"k8djEVymKYhbG/5eR2HKmpceP4o=\");\n\n_c = Postchat;\nconst ChatDiv = styled.div`\n  flex: none;\n  display: flex;\n  flex-direction: column;\n  flex: none;\n  width: 342px;\n  height: calc(100vh - 102px);\n  background-color: #f9f8ff;\n  border-radius: 8px;\n  overflow: hidden;\n`;\n_c2 = ChatDiv;\nconst ChatTab = styled.ul`\n  display: flex;\n  flex: none;\n  overflow: auto;\n\n  li {\n    padding: 0 22px;\n    margin: 0 10px;\n    font-size: 18px;\n    font-weight: 700;\n    line-height: 58px;\n    color: #5e45f2;\n    border-bottom: solid 3px #5e45f2;\n  }\n`;\n_c3 = ChatTab;\nconst ChatList = styled.div`\n  flex: auto;\n  padding: 0 10px;\n  overflow: auto;\n\n  ul {\n    padding-top: 30px;\n    overflow: hidden;\n  }\n\n  li {\n    width: 286px;\n\n    p {\n      padding: 8px;\n      word-break: break-all;\n      border-radius: 8px;\n    }\n\n    &.welcome {\n      color: #5e45f2;\n    }\n\n    &.user {\n      position: relative;\n      padding-left: 36px;\n      padding-right: 10px;\n\n      strong {\n        font-size: 14px;\n        color: #5e45f2;\n      }\n\n      p {\n        margin-top: 8px;\n        color: #333;\n        background-color: #fff;\n        box-shadow: 0 4px 14px 0 rgba(65, 0, 131, 0.06);\n      }\n\n      em {\n        display: block;\n        text-align: right;\n      }\n    }\n\n    &.self {\n      margin: 12px 0;\n      margin-left: auto;\n\n      p {\n        color: #fff;\n        background-color: #7966ff;\n      }\n    }\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-shadow: 0 0 4px 0 rgba(121, 102, 255, 0.2);\n  }\n\n  i {\n    color: #797979;\n    font-size: 12px;\n    font-style: normal;\n\n    &:before {\n      --dat-size: 2px;\n      content: \".\";\n      margin: 0 6px;\n      font-size: 16px;\n      vertical-align: super;\n    }\n  }\n\n  em {\n    display: block;\n    margin-top: 10px;\n    color: #797979;\n    font-size: 12px;\n    font-style: normal;\n  }\n`;\n_c4 = ChatList;\nconst ChatInput = styled.div`\n  padding: 24px 16px;\n  background-color: #f9f8ff;\n  box-shadow: 0 -4px 10px 0 rgba(133, 47, 243, 0.05);\n\n  > div {\n    display: flex;\n    align-items: center;\n    height: 42px;\n    padding: 8px 14px;\n    overflow: hidden;\n    border-radius: 10px;\n    box-shadow: inset 0 2px 6px 0 rgba(60, 4, 105, 0.08);\n    background-color: #fff;\n  }\n\n  input {\n    flex: auto;\n    padding: 0;\n    background-color: transparent;\n  }\n\n  button {\n    flex: none;\n    margin-left: 10px;\n    svg {\n      vertical-align: middle;\n    }\n  }\n`;\n_c5 = ChatInput;\nexport default Postchat;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"Postchat\");\n$RefreshReg$(_c2, \"ChatDiv\");\n$RefreshReg$(_c3, \"ChatTab\");\n$RefreshReg$(_c4, \"ChatList\");\n$RefreshReg$(_c5, \"ChatInput\");","map":{"version":3,"sources":["/Users/cyj/sun/src/components/Postchat.js"],"names":["React","Stomp","over","SockJs","Profile","styled","Swal","apiUrl","ReactComponent","SendSvg","stompClient","Postchat","pid","token","Authorization","sessionStorage","getItem","is_login","username","crareer","userImage","uid","welcome","setWelcome","useState","Map","publicChats","setPublicChats","connected","setConnected","tab","setTab","time","setTime","user","setUser","userData","setUserData","message","opposingUserName","useEffect","stompConnect","stompDisConnect","onKeyPress","e","key","sendPublicMessage","user_join","status","send","JSON","stringify","disconnect","unsubscribe","err","handleValue","value","name","target","socket","connect","onConnected","onError","senderName","subscribe","onPublicMessageReceived","console","log","fire","chatMessage","payload","payloadData","parse","body","get","set","userCount","time1","createdAt","split","time2","time3","push","keys","map","index","chat","ChatDiv","div","ChatTab","ul","ChatList","ChatInput"],"mappings":"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I;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAVA;MAAMD,O;AAYN,MAAME,OAAO,GAAGpF,MAAM,CAACqF,EAAG;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAdA;MAAMD,O;AAgBN,MAAME,QAAQ,GAAGtF,MAAM,CAACmF,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CArFA;MAAMG,Q;AAuFN,MAAMC,SAAS,GAAGvF,MAAM,CAACmF,GAAI;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CA7BA;MAAMI,S;AA+BN,eAAejF,QAAf","sourcesContent":["import React from \"react\";\nimport Stomp, { over } from \"stompjs\";\nimport SockJs from \"sockjs-client\";\nimport Profile from \"../elements/Profile\";\nimport styled from \"styled-components\";\nimport Swal from \"sweetalert2\";\nimport { apiUrl } from \"../elements/testApiUrl\";\nimport { ReactComponent as SendSvg } from \"../svg/send.svg\";\n\nlet stompClient = null;\nconst Postchat = ({ pid }) => {\n  const token = {\n    Authorization: sessionStorage.getItem(\"token\"),\n  };\n  const is_login = sessionStorage.getItem(\"is_Login\");\n  const username = sessionStorage.getItem(\"nickname\");\n  const crareer = sessionStorage.getItem(\"career\");\n  const userImage = sessionStorage.getItem(\"userImage\");\n  const uid = sessionStorage.getItem(\"uid\");\n\n  const [welcome, setWelcome] = React.useState(new Map());\n  const [publicChats, setPublicChats] = React.useState([]);\n  const [connected, setConnected] = React.useState(false);\n  const [tab, setTab] = React.useState(\"CHATROOM\");\n  const [time, setTime] = React.useState(\"\");\n  const [user, setUser] = React.useState(0);\n  const [userData, setUserData] = React.useState({\n    username: \"\",\n    message: \"\",\n    opposingUserName: \"\",\n  });\n\n  React.useEffect(() => {\n    stompConnect();\n\n    return () => {\n      stompDisConnect();\n    };\n  }, []);\n\n  const onKeyPress = (e) => {\n    if (e.key == \"Enter\") {\n      sendPublicMessage();\n    }\n  };\n\n  const stompDisConnect = () => {\n    try {\n      const user_join = { status: \"OUT\" };\n      stompClient.send(\"/app/message1\", {}, JSON.stringify(user_join));\n\n      stompClient.disconnect(() => {\n        stompClient.unsubscribe(`/topic/greetings/${pid}`);\n      }, token);\n    } catch (err) {}\n  };\n\n  const handleValue = (e) => {\n    const { value, name } = e.target;\n    setUserData({ ...userData, [name]: value });\n  };\n\n  const stompConnect = () => {\n    let socket = new SockJs(`${apiUrl}/ws`);\n    stompClient = Stomp.over(socket);\n    stompClient.connect({}, onConnected, onError);\n  };\n\n  const onConnected = () => {\n    try {\n      const username = sessionStorage.getItem(\"nickname\");\n      const crareer = sessionStorage.getItem(\"career\");\n      const userImage = sessionStorage.getItem(\"userImage\");\n      const user_join = { status: \"JOIN\", pid, uid };\n      setConnected(true);\n      setUserData({\n        ...userData,\n        crareer,\n        senderName: username,\n        status: \"JOIN\",\n        pid: pid,\n      });\n\n      stompClient.send(\"/app/message1\", token, JSON.stringify(user_join));\n      stompClient.subscribe(\n        `/topic/greetings/${pid}`,\n        onPublicMessageReceived,\n        token\n      );\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const sendPublicMessage = () => {\n    if (is_login) {\n      const username = sessionStorage.getItem(\"nickname\");\n\n      if (stompClient) {\n        if (!userData.message) {\n          Swal.fire(\"\", \"내용을 입력해주세요!\", \"error\");\n        } else {\n          let chatMessage = {\n            ...userData,\n            senderName: username,\n            message: userData.message,\n            status: \"MESSAGE\",\n            pid: pid,\n            uid: uid,\n          };\n\n          stompClient.send(\"/app/message1\", token, JSON.stringify(chatMessage));\n          setUserData({ ...userData, message: \"\" });\n        }\n      }\n    } else {\n      Swal.fire(\"\", \"로그인 후 사용할 수 있습니다:)\", \"error\");\n    }\n  };\n\n  //subscribe의 함수\n  const onPublicMessageReceived = (payload) => {\n    let payloadData = JSON.parse(payload.body);\n\n    switch (payloadData.status) {\n      case \"JOIN\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n          setUser(payloadData.userCount);\n        }\n        break;\n      case \"OUT\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n          setUser(payloadData.userCount);\n        }\n        break;\n      case \"OUT\":\n        if (!welcome.get(payloadData.senderName)) {\n          console.log(payloadData);\n          welcome.set(payloadData.message, []);\n          setWelcome(new Map(welcome));\n        }\n        break;\n      case \"MESSAGE\":\n        const time1 = payloadData.createdAt.split(\"T\")[1]; //년월 제거\n        const time2 = time1.split(\".\")[0]; // 소수점 제거\n        const time3 = time2.split(\":\")[0] + \":\" + time2.split(\":\")[1]; // 시간, 분\n        setTime(time3);\n        publicChats.push(payloadData);\n        setPublicChats([...publicChats]);\n        setUser(payloadData.userCount);\n        break;\n    }\n  };\n\n  const onError = (err) => {\n    console.log(err);\n    console.log(\"plz\");\n  };\n\n  return (\n    <ChatDiv>\n      <ChatTab>\n        <li\n          onClick={() => {\n            setTab(\"CHATROOM\");\n          }}>\n          채팅 {user}\n        </li>\n      </ChatTab>\n      <ChatList>\n        <ul>\n          {[...welcome.keys()].map((name, index) => {\n            return (\n              <li className='welcome' key={index}>\n                {name}\n              </li>\n            );\n          })}\n\n          {publicChats.map((chat, index) => (\n            <li\n              className={` ${chat.senderName === username ? \"self\" : \"user\"}`}\n              key={index}>\n              {chat.senderName !== username && (\n                <>\n                  <Profile size='32' imgUrl={userData.userImage} />\n                  <div>\n                    <strong>{chat.senderName}</strong>\n                    {userData.crareer && <i>{userData.crareer}</i>}\n                  </div>\n                </>\n              )}\n              <p className='message-data'>{chat.message}</p>\n              {time.split[0] > 12 ? (\n                <em> 오후 {time}</em>\n              ) : (\n                <em> 오전 {time} </em>\n              )}\n            </li>\n          ))}\n        </ul>\n      </ChatList>\n      <ChatInput>\n        <div>\n          <input\n            type='text'\n            name='message'\n            value={userData.message}\n            placeholder='댓글을 입력해주세요 :)'\n            onChange={handleValue}\n          />\n          <button onClick={sendPublicMessage}>\n            <SendSvg />\n          </button>\n        </div>\n      </ChatInput>\n    </ChatDiv>\n  );\n};\n\nconst ChatDiv = styled.div`\n  flex: none;\n  display: flex;\n  flex-direction: column;\n  flex: none;\n  width: 342px;\n  height: calc(100vh - 102px);\n  background-color: #f9f8ff;\n  border-radius: 8px;\n  overflow: hidden;\n`;\n\nconst ChatTab = styled.ul`\n  display: flex;\n  flex: none;\n  overflow: auto;\n\n  li {\n    padding: 0 22px;\n    margin: 0 10px;\n    font-size: 18px;\n    font-weight: 700;\n    line-height: 58px;\n    color: #5e45f2;\n    border-bottom: solid 3px #5e45f2;\n  }\n`;\n\nconst ChatList = styled.div`\n  flex: auto;\n  padding: 0 10px;\n  overflow: auto;\n\n  ul {\n    padding-top: 30px;\n    overflow: hidden;\n  }\n\n  li {\n    width: 286px;\n\n    p {\n      padding: 8px;\n      word-break: break-all;\n      border-radius: 8px;\n    }\n\n    &.welcome {\n      color: #5e45f2;\n    }\n\n    &.user {\n      position: relative;\n      padding-left: 36px;\n      padding-right: 10px;\n\n      strong {\n        font-size: 14px;\n        color: #5e45f2;\n      }\n\n      p {\n        margin-top: 8px;\n        color: #333;\n        background-color: #fff;\n        box-shadow: 0 4px 14px 0 rgba(65, 0, 131, 0.06);\n      }\n\n      em {\n        display: block;\n        text-align: right;\n      }\n    }\n\n    &.self {\n      margin: 12px 0;\n      margin-left: auto;\n\n      p {\n        color: #fff;\n        background-color: #7966ff;\n      }\n    }\n  }\n\n  span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-shadow: 0 0 4px 0 rgba(121, 102, 255, 0.2);\n  }\n\n  i {\n    color: #797979;\n    font-size: 12px;\n    font-style: normal;\n\n    &:before {\n      --dat-size: 2px;\n      content: \".\";\n      margin: 0 6px;\n      font-size: 16px;\n      vertical-align: super;\n    }\n  }\n\n  em {\n    display: block;\n    margin-top: 10px;\n    color: #797979;\n    font-size: 12px;\n    font-style: normal;\n  }\n`;\n\nconst ChatInput = styled.div`\n  padding: 24px 16px;\n  background-color: #f9f8ff;\n  box-shadow: 0 -4px 10px 0 rgba(133, 47, 243, 0.05);\n\n  > div {\n    display: flex;\n    align-items: center;\n    height: 42px;\n    padding: 8px 14px;\n    overflow: hidden;\n    border-radius: 10px;\n    box-shadow: inset 0 2px 6px 0 rgba(60, 4, 105, 0.08);\n    background-color: #fff;\n  }\n\n  input {\n    flex: auto;\n    padding: 0;\n    background-color: transparent;\n  }\n\n  button {\n    flex: none;\n    margin-left: 10px;\n    svg {\n      vertical-align: middle;\n    }\n  }\n`;\n\nexport default Postchat;\n"]},"metadata":{},"sourceType":"module"}