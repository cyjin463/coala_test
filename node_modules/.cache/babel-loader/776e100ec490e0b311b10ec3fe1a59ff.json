{"ast":null,"code":"import _defineProperty from\"/Users/cyj/sun/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _toConsumableArray from\"/Users/cyj/sun/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/cyj/sun/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _handleActions;import _regeneratorRuntime from\"/Users/cyj/sun/node_modules/@babel/runtime/regenerator/index.js\";import{createAction,handleActions}from\"redux-actions\";import axios from\"axios\";import{setToken}from\"../../shared/token\";import produce from\"immer\";import{apiUrl}from\"../../elements/testApiUrl\";import{apis}from\"../../shared/api\";var SERCH=\"SERCH\";var CATEGORY=\"CATEGORY\";var TAG=\"TAG\";var serch=createAction(SERCH,function(list){return{list:list};});var categorySerch=createAction(CATEGORY,function(list){return{list:list};});var tagSearch=createAction(TAG,function(list){return{list:list};});var token=sessionStorage.getItem(\"token\");var initialState={serch_list:[],category_list:[],tag_list:[]};var serchDB=function serchDB(title,page){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState,_ref){var history;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:history=_ref.history;console.log(title,page);_context.next=4;return axios.get(\"\".concat(apiUrl,\"/post/search/\").concat(title,\"?page=\").concat(page,\"&size=10&sortBy=createdAt&isAsc=false\"),{headers:{Authorization:token}}).then(function(res){console.log(res.data);dispatch(serch(res.data));return;if(res.data.length===0){console.log(res.data);var beforePage=page-1;console.log(beforePage);axios.get(\"\".concat(apiUrl,\"/post/search/\").concat(title,\"?page=\").concat(beforePage,\"&size=10&sortBy=createdAt&isAsc=false\"),{headers:{Authorization:token}}).then(function(res){console.log(res);dispatch(serch(res.data));});}else{console.log(res);dispatch(serch(res.data));}}).catch(function(err){console.log(err);});case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();};var categoryDB=function categoryDB(category,page){return function(dispatch,getState,_ref3){var history=_ref3.history;axios.get(\"\".concat(apiUrl,\"/category/search/\").concat(category,\"?page=\").concat(page,\"&size=10&sortBy=createdAt&isAsc=false\"),{headers:{Authorization:token}}).then(function(res){console.log(page);console.log(res.data);dispatch(categorySerch(res.data));}).catch(function(err){console.log(err);});};};var tagDB=function tagDB(tag,page){return function(dispatch,getState,_ref4){var history=_ref4.history;axios.get(\"\".concat(apiUrl,\"/tag/search/\").concat(tag,\"?page=\").concat(page,\"&size=10&sortBy=createdAt&isAsc=false\"),{headers:{Authorization:token}}).then(function(res){console.log(res.data);dispatch(tagSearch(res.data));}).catch(function(err){console.log(err);});};};export default handleActions((_handleActions={},_defineProperty(_handleActions,SERCH,function(state,action){return produce(state,function(draft){var _draft$serch_list;// draft.serch_list = action.payload.list;\n(_draft$serch_list=draft.serch_list).push.apply(_draft$serch_list,_toConsumableArray(action.payload.list));draft.serch_list=draft.serch_list.reduce(function(acc,cur){if(acc.findIndex(function(a){return a.pid===cur.pid;})===-1){return[].concat(_toConsumableArray(acc),[cur]);}else{acc[acc.findIndex(function(a){return a.pid===cur.pid;})]=cur;return acc;}},[]);});}),_defineProperty(_handleActions,CATEGORY,function(state,action){return produce(state,function(draft){var _draft$category_list;(_draft$category_list=draft.category_list).push.apply(_draft$category_list,_toConsumableArray(action.payload.list));draft.category_list=draft.category_list.reduce(function(acc,cur){if(acc.findIndex(function(a){return a.pid===cur.pid;})===-1){return[].concat(_toConsumableArray(acc),[cur]);}else{acc[acc.findIndex(function(a){return a.pid===cur.pid;})]=cur;return acc;}},[]);});}),_defineProperty(_handleActions,TAG,function(state,action){return produce(state,function(draft){var _draft$tag_list;(_draft$tag_list=draft.tag_list).push.apply(_draft$tag_list,_toConsumableArray(action.payload.list));draft.tag_list=draft.tag_list.reduce(function(acc,cur){if(acc.findIndex(function(a){return a.pid===cur.pid;})===-1){return[].concat(_toConsumableArray(acc),[cur]);}else{acc[acc.findIndex(function(a){return a.pid===cur.pid;})]=cur;return acc;}},[]);});}),_handleActions),initialState);var actionsCreators={serchDB:serchDB,serch:serch,categoryDB:categoryDB,categorySerch:categorySerch,tagDB:tagDB};export{actionsCreators};","map":{"version":3,"sources":["/Users/cyj/sun/src/redux/modules/serch.js"],"names":["createAction","handleActions","axios","setToken","produce","apiUrl","apis","SERCH","CATEGORY","TAG","serch","list","categorySerch","tagSearch","token","sessionStorage","getItem","initialState","serch_list","category_list","tag_list","serchDB","title","page","dispatch","getState","history","console","log","get","headers","Authorization","then","res","data","length","beforePage","catch","err","categoryDB","category","tagDB","tag","state","action","draft","push","payload","reduce","acc","cur","findIndex","a","pid","actionsCreators"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from \"redux-actions\";\nimport axios from \"axios\";\nimport { setToken } from \"../../shared/token\";\nimport produce from \"immer\";\nimport { apiUrl } from \"../../elements/testApiUrl\";\nimport { apis } from \"../../shared/api\";\n\nconst SERCH = \"SERCH\";\nconst CATEGORY = \"CATEGORY\";\nconst TAG = \"TAG\";\n\nconst serch = createAction(SERCH, (list) => ({ list }));\nconst categorySerch = createAction(CATEGORY, (list) => ({ list }));\nconst tagSearch = createAction(TAG, (list) => ({ list }));\n\nconst token = sessionStorage.getItem(\"token\");\n\nconst initialState = {\n  serch_list: [],\n  category_list: [],\n  tag_list: [],\n};\n\nconst serchDB = (title, page) => {\n  return async function (dispatch, getState, { history }) {\n    console.log(title, page);\n    await axios\n      .get(\n        `${apiUrl}/post/search/${title}?page=${page}&size=10&sortBy=createdAt&isAsc=false`,\n        {\n          headers: {\n            Authorization: token,\n          },\n        }\n      )\n      .then((res) => {\n        console.log(res.data);\n        dispatch(serch(res.data));\n        return;\n        if (res.data.length === 0) {\n          console.log(res.data);\n          const beforePage = page - 1;\n          console.log(beforePage);\n          axios\n            .get(\n              `${apiUrl}/post/search/${title}?page=${beforePage}&size=10&sortBy=createdAt&isAsc=false`,\n              {\n                headers: {\n                  Authorization: token,\n                },\n              }\n            )\n            .then((res) => {\n              console.log(res);\n              dispatch(serch(res.data));\n            });\n        } else {\n          console.log(res);\n          dispatch(serch(res.data));\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n};\n\nconst categoryDB = (category, page) => {\n  return function (dispatch, getState, { history }) {\n    axios\n      .get(\n        `${apiUrl}/category/search/${category}?page=${page}&size=10&sortBy=createdAt&isAsc=false`,\n        {\n          headers: {\n            Authorization: token,\n          },\n        }\n      )\n      .then((res) => {\n        console.log(page);\n        console.log(res.data);\n\n        dispatch(categorySerch(res.data));\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n};\n\nconst tagDB = (tag, page) => {\n  return function (dispatch, getState, { history }) {\n    axios\n      .get(\n        `${apiUrl}/tag/search/${tag}?page=${page}&size=10&sortBy=createdAt&isAsc=false`,\n        {\n          headers: {\n            Authorization: token,\n          },\n        }\n      )\n      .then((res) => {\n        console.log(res.data);\n        dispatch(tagSearch(res.data));\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n};\n\nexport default handleActions(\n  {\n    [SERCH]: (state, action) =>\n      produce(state, (draft) => {\n        // draft.serch_list = action.payload.list;\n        draft.serch_list.push(...action.payload.list);\n        draft.serch_list = draft.serch_list.reduce((acc, cur) => {\n          if (acc.findIndex((a) => a.pid === cur.pid) === -1) {\n            return [...acc, cur];\n          } else {\n            acc[acc.findIndex((a) => a.pid === cur.pid)] = cur;\n            return acc;\n          }\n        }, []);\n      }),\n    [CATEGORY]: (state, action) =>\n      produce(state, (draft) => {\n        draft.category_list.push(...action.payload.list);\n        draft.category_list = draft.category_list.reduce((acc, cur) => {\n          if (acc.findIndex((a) => a.pid === cur.pid) === -1) {\n            return [...acc, cur];\n          } else {\n            acc[acc.findIndex((a) => a.pid === cur.pid)] = cur;\n            return acc;\n          }\n        }, []);\n      }),\n    [TAG]: (state, action) =>\n      produce(state, (draft) => {\n        draft.tag_list.push(...action.payload.list);\n        draft.tag_list = draft.tag_list.reduce((acc, cur) => {\n          if (acc.findIndex((a) => a.pid === cur.pid) === -1) {\n            return [...acc, cur];\n          } else {\n            acc[acc.findIndex((a) => a.pid === cur.pid)] = cur;\n            return acc;\n          }\n        }, []);\n      }),\n  },\n  initialState\n);\n\nconst actionsCreators = {\n  serchDB,\n  serch,\n  categoryDB,\n  categorySerch,\n  tagDB,\n};\n\nexport { actionsCreators };\n"]},"metadata":{},"sourceType":"module"}