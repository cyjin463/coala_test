{"ast":null,"code":"import _defineProperty from\"/Users/cyj/sun/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _asyncToGenerator from\"/Users/cyj/sun/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _handleActions;import _regeneratorRuntime from\"/Users/cyj/sun/node_modules/@babel/runtime/regenerator/index.js\";import{createAction,handleActions}from\"redux-actions\";import{produce}from\"immer\";import history from\"../configureStore\";import axios from\"axios\";import Swal from\"sweetalert2\";import{setToken,delToken}from\"../../shared/token\";import{apiUrl}from\"../../elements/testApiUrl\";//initialState\nvar initialState={userinfo:{uid:\"\",username:\"\",nickname:\"\",career:\"\",userImage:\"\"},isLogin:false,isCheckUsername:false,isCheckNickname:false,preview:\"\"};//action\nvar CHECK_USERNAME=\"CHECK_USERNAME\";var CHECK_NICKNAME=\"CHECK_NICKNAME\";var LOG_IN=\"LOG_IN\";var LOG_OUT=\"LOG_OUT\";var USER_EDUT=\"USER_EDUT\";var IMG_POST=\"IMG_POST\";//action creators\nvar setCheckUsername=createAction(CHECK_USERNAME,function(isCheckUsername){return{isCheckUsername:isCheckUsername};});var setCheckNickname=createAction(CHECK_NICKNAME,function(isCheckNickname){return{isCheckNickname:isCheckNickname};});var logIn=createAction(LOG_IN,function(user){return{user:user};});var logOut=createAction(LOG_OUT,function(){return{};});var logEdit=createAction(USER_EDUT,function(user){return{user:user};});var imgPost=createAction(IMG_POST,function(preview){return{preview:preview};});// //token\nvar token=sessionStorage.getItem(\"token\");//middleware actions\nvar checkUsernameDB=function checkUsernameDB(username,isCheckUsername){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState,_ref){var history;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:history=_ref.history;console.log(username,isCheckUsername);_context.next=4;return axios.post(\"\".concat(apiUrl,\"/user/signup/username\"),{username:username}).then(function(res){if(res.data===true){Swal.fire(\"\",\"이미 존재하는 ID입니다.\",\"error\");return;}dispatch(setCheckUsername(!isCheckUsername));console.log(\"리듀서로\");});case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();};var checkNicknameDB=function checkNicknameDB(userNickname,isCheckNickname){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,getState,_ref3){var history;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:history=_ref3.history;console.log(userNickname,isCheckNickname);_context2.next=4;return axios.post(\"\".concat(apiUrl,\"/user/signup/nickname\"),{nickname:userNickname}).then(function(res){if(res.data===true){Swal.fire(\"\",\"이미 존재하는 닉네임입ㄴ디ㅏ.\",\"error\");return;}console.log(res);dispatch(setCheckNickname(!isCheckNickname));});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x4,_x5,_x6){return _ref4.apply(this,arguments);};}();};var signupDB=function signupDB(username,nickname,password,passwordCheck,career){return function(dispatch,getState,_ref5){var history=_ref5.history;console.log(username,nickname,password,passwordCheck,career);axios.post(\"\".concat(apiUrl,\"/user/signup\"),{username:username,nickname:nickname,password:password,passwordCheck:passwordCheck,career:career}).then(function(res){Swal.fire(\"\",\"회원가입을 축하드립니다.\",\"success\");window.location.reload();}).catch(function(err){console.log(\"회원가입 실패\",err);Swal.fire(\"\",\"회원가입에 실패했어요.\",\"error\");});};};var loginDB=function loginDB(username,password){return function(dispatch,getState,_ref6){var history=_ref6.history;console.log(username,password);axios.post(\"\".concat(apiUrl,\"/user/login\"),{username:username,password:password}).then(function(res){console.log(res);var token_res=res.headers.authorization;setToken(token_res);return token_res;}).then(function(token_res){console.log(token_res);axios({method:\"post\",url:\"\".concat(apiUrl,\"/islogin/user\"),headers:{Authorization:\"\".concat(token_res)}}).then(function(res){console.log(res);sessionStorage.setItem(\"uid\",res.data.uid);sessionStorage.setItem(\"username\",res.data.username);sessionStorage.setItem(\"nickname\",res.data.nickname);sessionStorage.setItem(\"career\",res.data.career);sessionStorage.setItem(\"userImage\",res.data.userImage);sessionStorage.setItem(\"url\",res.data.blogUrl);sessionStorage.setItem(\"isLogin\",true);console.log(\"1번\");dispatch(logIn({uid:res.data.uid,username:res.data.username,nickname:res.data.nickname,career:res.data.career,userImage:res.data.userImage,url:res.data.blogUrl}));history.push(\"/\");window.location.reload();}).catch(function(err){console.log(\"로그인 확인 실패\",err);});}).catch(function(err){console.log(err);Swal.fire(\"\",\"이메일이나 패스워드를 다시 확인해주세요.\",\"error\");});};};var logEditDB=function logEditDB(uid,nickname,career,url,userImg){return function(dispatch,getState,_ref7){var history=_ref7.history;console.log(uid,nickname,career,url);axios.put(\"\".concat(apiUrl,\"/islogin/user/getinfo/\").concat(uid),{nickname:nickname,career:career,userImage:\"\",blogUrl:url},{headers:{Authorization:token}}).then(function(res){console.log(res.data);dispatch(logEdit({nickname:nickname,career:career,userImage:userImg,blogUrl:url}));sessionStorage.setItem(\"nickname\",nickname);sessionStorage.setItem(\"career\",career);sessionStorage.setItem(\"url\",url);window.location.replace(\"/\");}).catch(function(err){console.log(err);Swal.fire(\"\",\"회원 정보 수정 실패\",\"error\");});};};var logEditDB2=function logEditDB2(uid,nickname,career,url,userImg){return function(dispatch,getState,_ref8){var history=_ref8.history;var img_list=getState().user.preview;var Data=new FormData();Data.append(\"images\",img_list);console.log(img_list);axios.post(\"\".concat(apiUrl,\"/images/upload\"),Data,{headers:{\"Content-Type\":\"multipart/form-data\",Authorization:token}}).then(function(res){console.log(\"img업로드 성공\");var imgUrl=res.data.url;return imgUrl;}).then(function(imgUrl){axios.put(\"\".concat(apiUrl,\"/islogin/user/getinfo/\").concat(uid),{nickname:nickname,career:career,userImage:imgUrl,blogUrl:url},{headers:{Authorization:token}}).then(function(res){console.log(res);dispatch(logEdit({nickname:nickname,career:career,userImage:userImg,blogUrl:url}));sessionStorage.setItem(\"nickname\",nickname);sessionStorage.setItem(\"career\",career);sessionStorage.setItem(\"userImage\",userImg);sessionStorage.setItem(\"url\",url);history.push(\"/\");window.location.reload();});}).catch(function(err){console.log(err);Swal.fire(\"\",\"회원 정보 수정 실패\",\"error\");});};};var NewPassWordDB=function NewPassWordDB(uid,password,newPassword,newPasswordCheck){console.log(\"간다\");return function(dispatch,getState,_ref9){var history=_ref9.history;axios.put(\"\".concat(apiUrl,\"/islogin/user/password/\").concat(uid),{password:password,newPassword:newPassword,newPasswordCheck:newPasswordCheck},{headers:{Authorization:token}}).then(function(res){console.log(res.data);if(res.data.result!==true){Swal.fire(\"\",\"비밀번호 수정 실패\",\"error\");window.location.reload();}else{Swal.fire(\"\",\"비밀번호 수정 성공\",\"success\");history.push(\"/\");window.location.replace(\"/\");}}).catch(function(err){console.log(err);Swal.fire(\"\",\"비밀번호 수정 실패\",\"error\");});};};export default handleActions((_handleActions={},_defineProperty(_handleActions,CHECK_USERNAME,function(state,action){return produce(state,function(draft){console.log(\"CHECK_USERNAME 리듀서로 적용 완료\",state,action.payload);draft.isCheckUsername=action.payload.isCheckUsername;Swal.fire(\"\",\"해당 이메일은 사용 가능합니다.\",\"success\");});}),_defineProperty(_handleActions,CHECK_NICKNAME,function(state,action){return produce(state,function(draft){console.log(\"CHECK_NICKNAME 리듀서 적용\",state,action.payload);draft.isCheckNickname=action.payload.isCheckNickname;Swal.fire(\"\",\"사용 가능한 닉네임입니다.\",\"success\");});}),_defineProperty(_handleActions,LOG_IN,function(state,action){return produce(state,function(draft){draft.userinfo=action.payload.user;draft.isLogin=true;});}),_defineProperty(_handleActions,USER_EDUT,function(state,action){return produce(state,function(draft){draft.userinfo=action.payload.user;});}),_defineProperty(_handleActions,IMG_POST,function(state,action){return produce(state,function(draft){draft.preview=action.payload.preview;});}),_handleActions),initialState);var actionCreators={signupDB:signupDB,checkUsernameDB:checkUsernameDB,checkNicknameDB:checkNicknameDB,loginDB:loginDB,logOut:logOut,logEditDB:logEditDB,logEditDB2:logEditDB2,NewPassWordDB:NewPassWordDB,imgPost:imgPost};export{actionCreators};","map":{"version":3,"sources":["/Users/cyj/sun/src/redux/modules/user.js"],"names":["createAction","handleActions","produce","history","axios","Swal","setToken","delToken","apiUrl","initialState","userinfo","uid","username","nickname","career","userImage","isLogin","isCheckUsername","isCheckNickname","preview","CHECK_USERNAME","CHECK_NICKNAME","LOG_IN","LOG_OUT","USER_EDUT","IMG_POST","setCheckUsername","setCheckNickname","logIn","user","logOut","logEdit","imgPost","token","sessionStorage","getItem","checkUsernameDB","dispatch","getState","console","log","post","then","res","data","fire","checkNicknameDB","userNickname","signupDB","password","passwordCheck","window","location","reload","catch","err","loginDB","token_res","headers","authorization","method","url","Authorization","setItem","blogUrl","push","logEditDB","userImg","put","replace","logEditDB2","img_list","Data","FormData","append","imgUrl","NewPassWordDB","newPassword","newPasswordCheck","result","state","action","draft","payload","actionCreators"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport history from \"../configureStore\";\nimport axios from \"axios\";\nimport Swal from \"sweetalert2\";\n\nimport { setToken, delToken } from \"../../shared/token\";\nimport { apiUrl } from \"../../elements/testApiUrl\";\n\n//initialState\nconst initialState = {\n  userinfo: {\n    uid: \"\",\n    username: \"\",\n    nickname: \"\",\n    career: \"\",\n    userImage: \"\",\n  },\n  isLogin: false,\n  isCheckUsername: false,\n  isCheckNickname: false,\n  preview: \"\",\n};\n\n//action\nconst CHECK_USERNAME = \"CHECK_USERNAME\";\nconst CHECK_NICKNAME = \"CHECK_NICKNAME\";\nconst LOG_IN = \"LOG_IN\";\nconst LOG_OUT = \"LOG_OUT\";\nconst USER_EDUT = \"USER_EDUT\";\nconst IMG_POST = \"IMG_POST\";\n\n//action creators\nconst setCheckUsername = createAction(CHECK_USERNAME, (isCheckUsername) => ({\n  isCheckUsername,\n}));\nconst setCheckNickname = createAction(CHECK_NICKNAME, (isCheckNickname) => ({\n  isCheckNickname,\n}));\nconst logIn = createAction(LOG_IN, (user) => ({ user }));\nconst logOut = createAction(LOG_OUT, () => ({}));\nconst logEdit = createAction(USER_EDUT, (user) => ({ user }));\nconst imgPost = createAction(IMG_POST, (preview) => ({ preview }));\n\n// //token\nconst token = sessionStorage.getItem(\"token\");\n\n//middleware actions\nconst checkUsernameDB = (username, isCheckUsername) => {\n  return async function (dispatch, getState, { history }) {\n    console.log(username, isCheckUsername);\n    await axios\n      .post(`${apiUrl}/user/signup/username`, { username: username })\n      .then((res) => {\n        if (res.data === true) {\n          Swal.fire(\"\", \"이미 존재하는 ID입니다.\", \"error\");\n          return;\n        }\n        dispatch(setCheckUsername(!isCheckUsername));\n        console.log(\"리듀서로\");\n      });\n  };\n};\n\nconst checkNicknameDB = (userNickname, isCheckNickname) => {\n  return async function (dispatch, getState, { history }) {\n    console.log(userNickname, isCheckNickname);\n    await axios\n      .post(`${apiUrl}/user/signup/nickname`, {\n        nickname: userNickname,\n      })\n      .then((res) => {\n        if (res.data === true) {\n          Swal.fire(\"\", \"이미 존재하는 닉네임입ㄴ디ㅏ.\", \"error\");\n          return;\n        }\n        console.log(res);\n        dispatch(setCheckNickname(!isCheckNickname));\n      });\n  };\n};\n\nconst signupDB = (username, nickname, password, passwordCheck, career) => {\n  return function (dispatch, getState, { history }) {\n    console.log(username, nickname, password, passwordCheck, career);\n    axios\n      .post(`${apiUrl}/user/signup`, {\n        username: username,\n        nickname: nickname,\n        password: password,\n        passwordCheck: passwordCheck,\n        career: career,\n      })\n      .then((res) => {\n        Swal.fire(\"\", \"회원가입을 축하드립니다.\", \"success\");\n        window.location.reload();\n      })\n      .catch((err) => {\n        console.log(\"회원가입 실패\", err);\n        Swal.fire(\"\", \"회원가입에 실패했어요.\", \"error\");\n      });\n  };\n};\n\nconst loginDB = (username, password) => {\n  return function (dispatch, getState, { history }) {\n    console.log(username, password);\n    axios\n      .post(`${apiUrl}/user/login`, {\n        username: username,\n        password: password,\n      })\n      .then((res) => {\n        console.log(res);\n        const token_res = res.headers.authorization;\n        setToken(token_res);\n        return token_res;\n      })\n      .then((token_res) => {\n        console.log(token_res);\n        axios({\n          method: \"post\",\n          url: `${apiUrl}/islogin/user`,\n          headers: {\n            Authorization: `${token_res}`,\n          },\n        })\n          .then((res) => {\n            console.log(res);\n            sessionStorage.setItem(\"uid\", res.data.uid);\n            sessionStorage.setItem(\"username\", res.data.username);\n            sessionStorage.setItem(\"nickname\", res.data.nickname);\n            sessionStorage.setItem(\"career\", res.data.career);\n            sessionStorage.setItem(\"userImage\", res.data.userImage);\n            sessionStorage.setItem(\"url\", res.data.blogUrl);\n            sessionStorage.setItem(\"isLogin\", true);\n            console.log(\"1번\");\n            dispatch(\n              logIn({\n                uid: res.data.uid,\n                username: res.data.username,\n                nickname: res.data.nickname,\n                career: res.data.career,\n                userImage: res.data.userImage,\n                url: res.data.blogUrl,\n              })\n            );\n            history.push(\"/\");\n            window.location.reload();\n          })\n          .catch((err) => {\n            console.log(\"로그인 확인 실패\", err);\n          });\n      })\n      .catch((err) => {\n        console.log(err);\n        Swal.fire(\"\", \"이메일이나 패스워드를 다시 확인해주세요.\", \"error\");\n      });\n  };\n};\n\nconst logEditDB = (uid, nickname, career, url, userImg) => {\n  return function (dispatch, getState, { history }) {\n    console.log(uid, nickname, career, url);\n    axios\n      .put(\n        `${apiUrl}/islogin/user/getinfo/${uid}`,\n        {\n          nickname: nickname,\n          career: career,\n          userImage: \"\",\n          blogUrl: url,\n        },\n        {\n          headers: {\n            Authorization: token,\n          },\n        }\n      )\n      .then((res) => {\n        console.log(res.data);\n        dispatch(\n          logEdit({\n            nickname: nickname,\n            career: career,\n            userImage: userImg,\n            blogUrl: url,\n          })\n        );\n        sessionStorage.setItem(\"nickname\", nickname);\n        sessionStorage.setItem(\"career\", career);\n        sessionStorage.setItem(\"url\", url);\n        window.location.replace(\"/\");\n      })\n      .catch((err) => {\n        console.log(err);\n        Swal.fire(\"\", \"회원 정보 수정 실패\", \"error\");\n      });\n  };\n};\n\nconst logEditDB2 = (uid, nickname, career, url, userImg) => {\n  return function (dispatch, getState, { history }) {\n    const img_list = getState().user.preview;\n    const Data = new FormData();\n    Data.append(\"images\", img_list);\n    console.log(img_list);\n    axios\n      .post(`${apiUrl}/images/upload`, Data, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: token,\n        },\n      })\n      .then((res) => {\n        console.log(\"img업로드 성공\");\n        const imgUrl = res.data.url;\n        return imgUrl;\n      })\n\n      .then((imgUrl) => {\n        axios\n          .put(\n            `${apiUrl}/islogin/user/getinfo/${uid}`,\n            {\n              nickname: nickname,\n              career: career,\n              userImage: imgUrl,\n              blogUrl: url,\n            },\n            {\n              headers: {\n                Authorization: token,\n              },\n            }\n          )\n          .then((res) => {\n            console.log(res);\n            dispatch(\n              logEdit({\n                nickname: nickname,\n                career: career,\n                userImage: userImg,\n                blogUrl: url,\n              })\n            );\n            sessionStorage.setItem(\"nickname\", nickname);\n            sessionStorage.setItem(\"career\", career);\n            sessionStorage.setItem(\"userImage\", userImg);\n            sessionStorage.setItem(\"url\", url);\n            history.push(\"/\");\n            window.location.reload();\n          });\n      })\n      .catch((err) => {\n        console.log(err);\n        Swal.fire(\"\", \"회원 정보 수정 실패\", \"error\");\n      });\n  };\n};\n\nconst NewPassWordDB = (uid, password, newPassword, newPasswordCheck) => {\n  console.log(\"간다\");\n  return function (dispatch, getState, { history }) {\n    axios\n      .put(\n        `${apiUrl}/islogin/user/password/${uid}`,\n        {\n          password: password,\n          newPassword: newPassword,\n          newPasswordCheck: newPasswordCheck,\n        },\n        {\n          headers: {\n            Authorization: token,\n          },\n        }\n      )\n      .then((res) => {\n        console.log(res.data);\n        if (res.data.result !== true) {\n          Swal.fire(\"\", \"비밀번호 수정 실패\", \"error\");\n          window.location.reload();\n        } else {\n          Swal.fire(\"\", \"비밀번호 수정 성공\", \"success\");\n          history.push(\"/\");\n          window.location.replace(\"/\");\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        Swal.fire(\"\", \"비밀번호 수정 실패\", \"error\");\n      });\n  };\n};\n\nexport default handleActions(\n  {\n    [CHECK_USERNAME]: (state, action) =>\n      produce(state, (draft) => {\n        console.log(\"CHECK_USERNAME 리듀서로 적용 완료\", state, action.payload);\n        draft.isCheckUsername = action.payload.isCheckUsername;\n        Swal.fire(\"\", \"해당 이메일은 사용 가능합니다.\", \"success\");\n      }),\n    [CHECK_NICKNAME]: (state, action) =>\n      produce(state, (draft) => {\n        console.log(\"CHECK_NICKNAME 리듀서 적용\", state, action.payload);\n        draft.isCheckNickname = action.payload.isCheckNickname;\n        Swal.fire(\"\", \"사용 가능한 닉네임입니다.\", \"success\");\n      }),\n    [LOG_IN]: (state, action) =>\n      produce(state, (draft) => {\n        draft.userinfo = action.payload.user;\n        draft.isLogin = true;\n      }),\n    [USER_EDUT]: (state, action) =>\n      produce(state, (draft) => {\n        draft.userinfo = action.payload.user;\n      }),\n    [IMG_POST]: (state, action) =>\n      produce(state, (draft) => {\n        draft.preview = action.payload.preview;\n      }),\n  },\n  initialState\n);\n\nconst actionCreators = {\n  signupDB,\n  checkUsernameDB,\n  checkNicknameDB,\n  loginDB,\n  logOut,\n  logEditDB,\n  logEditDB2,\n  NewPassWordDB,\n  imgPost,\n};\n\nexport { actionCreators };\n"]},"metadata":{},"sourceType":"module"}